// ignore_for_file: public_member_api_docs, sort_constructors_first
import 'dart:convert';

import 'package:core_utils/core_utils.dart';
import 'package:lang_tube/crud/subtitles_cache_manager/constants.dart';
import 'package:youtube_subtitles_scraper/youtube_subtitles_scraper.dart';

final class CachedSourceCaptions extends SourceCaptions {
  final DateTime? cacheCreationDate;
  const CachedSourceCaptions({
    required super.uri,
    required super.videoId,
    required super.isAutoGenerated,
    required this.cacheCreationDate,
  });

  Map<String, dynamic> toMap() {
    return <String, dynamic>{
      'uri': uri.toString(),
      'videoId': videoId,
      'isAutoGenerated': isAutoGenerated,
    };
  }

  factory CachedSourceCaptions.fromMap(Map<String, dynamic> map) {
    return CachedSourceCaptions(
      uri: Uri.parse(map[subtitlesSourceColumn]),
      videoId: map[videoIdColumn] as String,
      isAutoGenerated: (map[isSubtitleAutoGeneratedColumn] as int).toBool(),
      cacheCreationDate: DateTime.tryParse(map[subtitlesCacheDate]),
    );
  }

  String toJson() => json.encode(toMap());

  factory CachedSourceCaptions.fromJson(String source) =>
      CachedSourceCaptions.fromMap(json.decode(source) as Map<String, dynamic>);
}
